<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>제주도 여행 계획 타임라인 (최종 디버깅용)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .timeline-item-container.active .timeline-content {
            transform: scale(1.02);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            border-color: #14B8A6;
        }
        .timeline-content {
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #14B8A6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .custom-overlay-content {
            background-color: #14B8A6;
            color: white;
            padding: 4px 8px;
            border-radius: 9999px;
            font-weight: bold;
            font-size: 14px;
            text-align: center;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body class="bg-stone-50 font-sans text-stone-800">

    <div id="app" class="flex flex-col lg:flex-row w-full min-h-screen">
        <aside class="w-full lg:w-1/3 xl:w-1/4 p-6 bg-white shadow-lg overflow-y-auto">
            <header class="mb-6 pb-4 border-b border-stone-200">
                <h1 class="text-3xl font-bold text-stone-900">제주 여행 타임라인</h1>
                <p class="text-stone-500 mt-1">10월 7일 ~ 10월 8일</p>
            </header>
            <nav id="day-selector" class="flex gap-2 mb-6">
                <button data-day="1" class="day-btn flex-1 bg-teal-600 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:bg-teal-700 transition-all duration-300">Day 1</button>
                <button data-day="2" class="day-btn flex-1 bg-white text-stone-700 font-bold py-3 px-4 rounded-lg shadow-md hover:bg-stone-100 transition-all duration-300">Day 2</button>
            </nav>
            <div id="timeline-container" class="relative"></div>
        </aside>
        <main class="w-full lg:w-2/3 xl:w-3/4 h-[50vh] lg:h-screen">
            <div id="map" class="w-full h-full bg-gray-100 flex items-center justify-center text-center p-4 text-gray-500">
                지도를 불러오는 중입니다... <br> 이 메시지가 사라지지 않으면 개발자 콘솔(F12)을 확인해주세요.
            </div>
        </main>
    </div>
    
    <div id="gemini-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md p-6 relative">
            <button id="close-modal-btn" class="absolute top-3 right-3 text-stone-400 hover:text-stone-700 text-2xl leading-none">&times;</button>
            <h2 class="text-2xl font-bold text-stone-900 mb-4 flex items-center gap-2">✨ 주변 추천 장소</h2>
            <div id="modal-content" class="text-stone-700 max-h-[60vh] overflow-y-auto"></div>
        </div>
    </div>

    <script>
        // --- 설정 영역 ---
        /* [중요] API 키 입력 #1 
          아래 "YOUR_KAKAO_APP_KEY" 부분을 **다시 한번 정확하게** 본인의 카카오맵 Javascript 키로 교체해주세요.
          (기존 값을 지우고 새로 붙여넣는 것을 권장합니다.)
        */
        const KAKAO_APP_KEY = 'd3c3d2e4c30d1ef210332f70e5394b36';

        /* [중요] API 키 입력 #2
          아래 "YOUR_GEMINI_API_KEY" 부분을 본인의 Gemini API 키로 교체해주세요.
        */
        const GEMINI_API_KEY = 'AIzaSyAHaulmvkZyChIOH1bDVpgtYjijqaiXefA';

        const travelData = {
            1: [
                { time: '10:00', place: '제주국제공항', activity: '도착', lat: 33.510413, lng: 126.491353, icon: '✈️' },
                { time: '11:00', place: '명랑스낵', activity: '한치 튀김, 떡볶이', lat: 33.31301, lng: 126.29949, icon: '🍜' },
                { time: '12:30', place: '풀베개', activity: '커피', lat: 33.31688, lng: 126.30252, icon: '☕' },
                { time: '14:00', place: '제주부영호텔&리조트', activity: '체크인', lat: 33.2458, lng: 126.4087, icon: '🏨' },
                { time: '15:00', place: '번네식당', activity: '갈치조림 식사', lat: 33.2494, lng: 126.4252, icon: '🍲' },
                { time: '16:30', place: '제주부영호텔&리조트', activity: '휴식', lat: 33.2458, lng: 126.4087, icon: '🛌' },
                { time: '18:30', place: '칠돈가 중문점', activity: '흑돼지 구이 식사', lat: 33.2505, lng: 126.4170, icon: '🍖' },
                { time: '20:00', place: '제주부영호텔&리조트', activity: '휴식', lat: 33.2458, lng: 126.4087, icon: '🌙' }
            ],
            2: [
                { time: '09:00', place: '제주선채향', activity: '전복칼국수 식사', lat: 33.2483, lng: 126.4251, icon: '🍜' },
                { time: '10:30', place: '위이', activity: '커피', lat: 33.2536, lng: 126.4385, icon: '☕' },
                { time: '12:00', place: '오는정 김밥', activity: '김밥 포장', lat: 33.2497, lng: 126.5623, icon: '🍙' },
                { time: '14:00', place: '아쿠아뷰티크', activity: '체크인', lat: 33.5435, lng: 126.6668, icon: '🏨' },
                { time: '17:00', place: '숙성도 함덕점', activity: '흑돼지 구이 식사', lat: 33.5430, lng: 126.6675, icon: '🍖' },
                { time: '19:00', place: '미영이네 조천점', activity: '고등어 회 포장', lat: 33.5450, lng: 126.6974, icon: '🍣' },
                { time: '20:00', place: '아쿠아뷰티크', activity: '휴식', lat: 33.5435, lng: 126.6668, icon: '🌙' }
            ]
        };

        // --- 애플리케이션 로직 ---

        let map;
        let markers = [];
        let polyline;
        let currentDay = 1;

        function initMap() {
            const mapContainer = document.getElementById('map');
            const mapOption = { 
                center: new kakao.maps.LatLng(33.361665, 126.520412),
                level: 10
            };
            map = new kakao.maps.Map(mapContainer, mapOption);
            
            setupEventListeners();
            setupModal();
            updateView();
        }

        // --- 디버깅 기능이 강화된 API 로더 ---
        function loadKakaoMapAPI() {
            if (!KAKAO_APP_KEY || KAKAO_APP_KEY === "YOUR_KAKAO_APP_KEY") {
                document.getElementById('map').innerHTML = '카카오맵 API 키가 입력되지 않았습니다.<br>코드를 수정해주세요.';
                console.error("카카오맵 API 키가 비어있습니다.");
                return;
            }

            const script = document.createElement('script');
            script.type = 'text/javascript';
            script.src = `//dapi.kakao.com/v2/maps/sdk.js?appkey=${KAKAO_APP_KEY}&libraries=services&autoload=false`;
            script.onload = () => {
                console.log("카카오맵 API 스크립트 로드 성공!");
                kakao.maps.load(initMap);
            };
            script.onerror = () => {
                document.getElementById('map').innerHTML = '카카오맵 API 스크립트를 불러오지 못했습니다.<br>F12를 눌러 개발자 콘솔의 오류 메시지를 확인해주세요.';
                console.error("카카오맵 API 스크립트 로드 실패! API 키, 도메인 설정, 네트워크 연결을 확인하세요.");
            };
            document.head.appendChild(script);
        }
        
        loadKakaoMapAPI(); // 애플리케이션 시작

        // ...(이하 다른 함수들은 이전과 동일)...
        function setupEventListeners(){const daySelector=document.getElementById("day-selector");daySelector.addEventListener("click",e=>{const t=e.target.closest(".day-btn");t&&parseInt(t.dataset.day)!==currentDay&&(currentDay=parseInt(t.dataset.day),updateView(),updateButtonStyles())})}function setupModal(){const e=document.getElementById("gemini-modal"),t=document.getElementById("close-modal-btn");t.addEventListener("click",()=>e.classList.add("hidden")),e.addEventListener("click",t=>{t.target===e&&e.classList.add("hidden")})}async function getGeminiSuggestions(e){if("YOUR_GEMINI_API_KEY"===GEMINI_API_KEY||!GEMINI_API_KEY)return void alert("Gemini API 키를 입력해주세요.");const t=document.getElementById("gemini-modal"),n=document.getElementById("modal-content");t.classList.remove("hidden"),n.innerHTML='<div class="loader"></div>';const o=`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${GEMINI_API_KEY}`,a=`'${e}, 제주도' 근처의 현지인들이 좋아할 만한 숨겨진 맛집, 독특한 카페, 또는 가볼 만한 장소 3곳을 추천해 줘. 각 장소에 대한 설명은 한두 문장으로 간결하게 해주고, 추천 이유를 꼭 포함해줘.`;try{const e=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:a}]}]})});if(!e.ok)throw new Error(`API 요청 실패: ${e.status}`);const t=(await e.json())?.candidates?.[0]?.content?.parts?.[0]?.text;if(t)n.innerHTML=t.replace(/\n/g,"<br>");else throw new Error("Invalid API response structure")}catch(e){console.error("Gemini API 호출 중 오류 발생:",e),n.innerHTML='<p class="text-red-500">추천 정보를 불러오는 데 실패했습니다. API 키와 네트워크 연결을 확인해주세요.</p>'}}function updateButtonStyles(){document.querySelectorAll(".day-btn").forEach(e=>{parseInt(e.dataset.day)===currentDay?(e.classList.remove("bg-white","text-stone-700"),e.classList.add("bg-teal-600","text-white")):(e.classList.remove("bg-teal-600","text-white"),e.classList.add("bg-white","text-stone-700"))})}function clearMap(){markers.forEach(e=>e.overlay.setMap(null)),markers=[],polyline&&polyline.setMap(null)}function createTimelineHTML(e){return`\n                <div class="absolute left-4 top-0 bottom-0 w-0.5 bg-stone-200"></div>\n                ${e.map((e,t)=>`\n                    <div class="timeline-item-container relative mb-4" data-index="${t}">\n                        <div class="timeline-dot absolute left-4 top-6 w-4 h-4 bg-white border-4 border-teal-500 rounded-full" style="transform: translate(-50%, -50%);"></div>\n                        <div class="timeline-content ml-12 p-4 bg-white rounded-lg shadow-md">\n                            <div class="timeline-item cursor-pointer">\n                                <span class="text-sm font-bold text-teal-600">${e.time}</span>\n                                <h3 class="font-semibold text-lg text-stone-800">${t+1}. ${e.place}</h3>\n                                <p class="text-stone-600">${e.icon} ${e.activity}</p>\n                            </div>\n                            <div class="mt-3 pt-3 border-t border-stone-200">\n                                <button class="gemini-suggest-btn w-full text-left text-sm font-semibold text-teal-600 hover:text-teal-800 transition-colors" data-place="${e.place}">주변 추천받기 ✨</button>\n                            </div>\n                        </div>\n                    </div>\n                `).join("")}\n            `}function updateView(){clearMap();const e=travelData[currentDay];document.getElementById("timeline-container").innerHTML=createTimelineHTML(e);const t=new kakao.maps.LatLngBounds,n=[];e.forEach((e,o)=>{const a=new kakao.maps.LatLng(e.lat,e.lng);n.push(a),t.extend(a);const i=document.createElement("div");i.className="custom-overlay-content",i.innerHTML=o+1;const d=new kakao.maps.CustomOverlay({position:a,content:i,yAnchor:1.2});d.setMap(map),i.addEventListener("click",()=>{panTo(a),highlightTimelineItem(o)}),markers.push({overlay:d,position:a,index:o})}),map.setBounds(t),polyline=new kakao.maps.Polyline({path:n,strokeWeight:4,strokeColor:"#0D9488",strokeOpacity:.8,strokeStyle:"solid"}),polyline.setMap(map),addTimelineEventListeners()}function addTimelineEventListeners(){document.getElementById("timeline-container").addEventListener("click",e=>{const t=e.target.closest(".timeline-item");if(t){const n=t.closest(".timeline-item-container"),o=parseInt(n.dataset.index),a=markers.find(e=>e.index===o);a&&(panTo(a.position),highlightTimelineItem(o))}const n=e.target.closest(".gemini-suggest-btn");n&&(e.stopPropagation(),getGeminiSuggestions(n.dataset.place))})}function panTo(e){map.panTo(e)}function highlightTimelineItem(e){document.querySelectorAll(".timeline-item-container").forEach((t,n)=>{n===e?t.classList.contains("active")||(t.classList.add("active"),t.scrollIntoView({behavior:"smooth",block:"center"})):t.classList.remove("active")})}
    </script>
</body>
</html>
